var sprites = {
    mole_appear: {sx:-114, sy:-140, w:33, h:35, frames:7},
    mole_disappear: {sx:-131, sy:-172, w:40, h:32, frames:8},
    moe_hit: {sx:-260, sy:-30, w:34, h:40, frames:3}
}

var width = $("#playground").width(),
height  = $("#playground").height(),
countdown = 5, countup = 0;

window.onload = function() {
    // cache a new image
    var image = new Image();
    image.onload = playGame;
    image.src = "mole.png";
	
}

var Mole = function() {
    
    this.x = Math.random()*width;
    this.y = Math.random()*height;
    this.sprite = sprites.mole_appear;
    this.currFrame = 0;

    this.elem = $("<div>").css({
	position: 'absolute',
	left: this.x, top: this.y,
	width: this.sprite.w, height: this.sprite.h,
	background: "url(mole.png)",
	"background-position-x": this.sprite.sx + "px",
	"background-position-y": this.sprite.sy + "px"
    }).appendTo("#container");

    this.appear = function(frame) {};
    this.hit = function(frame) {};
    this.disappear = function(frame) {};

    this.step = function() {
	if (this.currFrame < this.sprite.frames) {
	    console.log(this.currFrame);
	    console.log(this.sprite.sx)
	    console.log(""+(this.sprite.sx
			     -this.currFrame*this.sprite.w)
			 +"px");

	    this.currFrame++;
	    this.elem.css("background-position-x", 
			  "" + (this.sprite.sx
				-this.currFrame*this.sprite.w)
			  +"px");
	}
    };
    this.draw = function() {
    };
}

var playGame = function() {
    var theMole = new Mole();
    var Timer = setInterval(function() {
	--countdown;
	theMole.step();
	theMole.draw();
	if (countdown <= 0) gameOver(Timer);
    },500);
}

var gameOver = function(timer) {
    if (timer) clearInterval(timer);
    countup > 15 ? alert("You win! :)") : alert("You let the mole run away :(")
}